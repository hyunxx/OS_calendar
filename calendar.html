<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>FullCalendar for Students</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./src/main.css">
    <style>
        body {
            margin: 0 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
    </style>
</head>

<body>
    <header class="header">

    </header>
    <div class="calendar-page">
      <h1>ğŸ—“ï¸ ìº˜ë¦°ë”</h1>
      <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <button id="addManualBtn">â• ì¼ì • ì§ì ‘ ì¶”ê°€</button>
          <button id="showTodayBtn">ğŸ“… ì˜¤ëŠ˜ í•  ì¼</button>
          <button id="toggleDarkMode">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
      </div>
      <div id="calendar"></div>
    </div>

    <!-- ì¼ì • ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">ì¼ì • ì¶”ê°€</h3>
            <input type="date" id="eventDate" style="display: none;">
            <input type="text" id="eventTitle" placeholder="ì œëª©">
            <textarea id="eventDesc" rows="3" placeholder="ë‚´ìš©"></textarea>
            <select id="eventCategory">
        <option value="class">ğŸ“˜ ìˆ˜ì—…</option>
        <option value="study">ğŸ”¬ ê³µë¶€</option>
        <option value="assignment">ğŸ“ ê³¼ì œ</option>
        <option value="exam">âœï¸ ì‹œí—˜</option>
        <option value="club">ğŸƒ ë™ì•„ë¦¬</option>
        <option value="meeting">ğŸ“… íšŒì˜</option>
        <option value="social">ğŸ• ì•½ì†</option>
        <option value="etc">ğŸ§© ê¸°íƒ€</option>
      </select>
            <div class="modal-buttons">
                <button id="saveBtn" style="background-color: #bbffbb;">ì €ì¥</button>
                <button id="deleteBtn" style="background-color: #ffbbbb;">ì‚­ì œ</button>
                <button id="cancelBtn">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì • í™•ì¸ ëª¨ë‹¬ -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ“Œ ì¼ì • í™•ì¸</h3>
            <p><strong>ì œëª©:</strong> <span id="viewTitle"></span></p>
            <p><strong>ë‚´ìš©:</strong> <span id="viewDesc"></span></p>
            <p><strong>ì¹´í…Œê³ ë¦¬:</strong> <span id="viewCategory"></span></p>
            <div class="modal-buttons">
                <button id="viewEdit" style="background-color:#bbffbb;">í¸ì§‘</button>
                <button id="viewClose">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <p>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button id="confirmYes" style="background-color:#ffbbbb;">ì‚­ì œ</button>
                <button id="confirmNo">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì˜¤ëŠ˜ ì¼ì • ëª¨ë‹¬ -->
    <div id="todayTasksModal" class="modal">
        <div class="modal-content">
            <h3>âœ… ì˜¤ëŠ˜ì˜ ì¼ì •</h3>
            <ul id="todayTasksList"></ul>
            <div class="modal-buttons">
                <button onclick="document.getElementById('todayTasksModal').style.display='none'">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav"></div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let selectInfo = null;
            let activeEvent = null;

            const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                editable: true,
                selectable: true,
                selectMirror: true,
                select: function(info) {
                    selectInfo = info;
                    activeEvent = null;
                    showModal('ì¼ì • ì¶”ê°€', info.startStr);
                    document.getElementById('eventDate').style.display = 'none';
                },
                events: JSON.parse(localStorage.getItem('calendarEvents') || '[]'),
                eventClick(info) {
                    activeEvent = info.event;
                    document.getElementById('viewTitle').textContent = activeEvent.title;
                    document.getElementById('viewDesc').textContent = activeEvent.extendedProps.description || '-';
                    const categoryMap = {
                        class: 'ğŸ“˜ ìˆ˜ì—…',
                        study: 'ğŸ”¬ ê³µë¶€',
                        assignment: 'ğŸ“ ê³¼ì œ',
                        exam: 'âœï¸ ì‹œí—˜',
                        club: 'ğŸƒ ë™ì•„ë¦¬',
                        meeting: 'ğŸ“… íšŒì˜',
                        social: 'ğŸ• ì•½ì†',
                        etc: 'ğŸ§© ê¸°íƒ€'
                    };
                    document.getElementById('viewCategory').textContent = categoryMap[activeEvent.extendedProps.category] || 'ê¸°íƒ€';
                    document.getElementById('viewModal').style.display = 'block';
                },
                eventDrop: saveAll,
                eventResize: saveAll
            });

            calendar.render();

            function showModal(title, dateStr = '') {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventDesc').value = '';
                document.getElementById('eventCategory').value = 'class';
                document.getElementById('eventDate').value = dateStr;
                document.getElementById('eventDate').style.display = dateStr ? 'none' : 'block';
                document.getElementById('eventModal').style.display = 'block';
            }

            function saveAll() {
                const current = calendar.getEvents().map(e => ({
                    title: e.title,
                    description: e.extendedProps.description || '',
                    category: e.extendedProps.category || '',
                    start: e.startStr,
                    end: e.endStr || null,
                    color: e.backgroundColor
                }));
                localStorage.setItem('calendarEvents', JSON.stringify(current));
            }

            document.getElementById('saveBtn').onclick = () => {
                const title = document.getElementById('eventTitle').value.trim();
                const desc = document.getElementById('eventDesc').value.trim();
                const date = document.getElementById('eventDate').value;
                const category = document.getElementById('eventCategory').value;
                const colorMap = {
                    class: '#007bff',
                    study: '#6f42c1',
                    assignment: '#dc3545',
                    exam: '#ffc107',
                    club: '#28a745',
                    meeting: '#20c997',
                    social: '#fd7e14',
                    etc: '#6c757d'
                };
                const color = colorMap[category];

                if (selectInfo && title) {
                    const endDate = new Date(selectInfo.end);
                    endDate.setDate(endDate.getDate() - 1);
                    calendar.addEvent({
                        title,
                        description: desc,
                        category,
                        start: selectInfo.start,
                        end: selectInfo.end,
                        allDay: selectInfo.allDay,
                        color
                    });
                } else if (activeEvent) {
                    activeEvent.setProp('title', title);
                    activeEvent.setExtendedProp('description', desc);
                    activeEvent.setExtendedProp('category', category);
                    activeEvent.setProp('backgroundColor', color);
                } else if (date && title) {
                    calendar.addEvent({
                        title,
                        description: desc,
                        category,
                        start: date,
                        color
                    });
                }

                saveAll();
                document.getElementById('eventModal').style.display = 'none';
                document.getElementById('viewModal').style.display = 'none';
                selectInfo = null;
                activeEvent = null;
            };

            document.getElementById('deleteBtn').onclick = () => document.getElementById('confirmModal').style.display = 'block';

            document.getElementById('confirmYes').onclick = () => {
                if (activeEvent) activeEvent.remove();
                saveAll();
                ['confirmModal', 'eventModal', 'viewModal'].forEach(id => document.getElementById(id).style.display = 'none');
                activeEvent = null;
            };

            document.getElementById('confirmNo').onclick = () => document.getElementById('confirmModal').style.display = 'none';
            document.getElementById('cancelBtn').onclick = () => document.getElementById('eventModal').style.display = 'none';
            document.getElementById('viewClose').onclick = () => document.getElementById('viewModal').style.display = 'none';

            document.getElementById('viewEdit').onclick = () => {
                showModal('ì¼ì • ìˆ˜ì •', activeEvent.startStr.slice(0, 10));
                document.getElementById('eventTitle').value = activeEvent.title;
                document.getElementById('eventDesc').value = activeEvent.extendedProps.description;
                document.getElementById('eventCategory').value = activeEvent.extendedProps.category;
                document.getElementById('eventDate').style.display = 'block';
                document.getElementById('viewModal').style.display = 'none';
            };

            document.getElementById('addManualBtn').onclick = () => showModal('ì¼ì • ì§ì ‘ ì¶”ê°€');
            document.getElementById('toggleDarkMode').onclick = () => document.body.classList.toggle('dark-mode');

            document.getElementById('showTodayBtn').onclick = () => {
                const isSameDate = (d1, d2) =>
                    d1.getFullYear() === d2.getFullYear() &&
                    d1.getMonth() === d2.getMonth() &&
                    d1.getDate() === d2.getDate();

                const today = new Date();
                const list = calendar.getEvents().filter(e => isSameDate(new Date(e.start), today));

                const out = list.map(e => `<li>${e.title}</li>`).join('') || '<li>ì˜¤ëŠ˜ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                document.getElementById('todayTasksList').innerHTML = out;
                document.getElementById('todayTasksModal').style.display = 'block';
            };

            window.onclick = e => {
                if ([...document.getElementsByClassName('modal')].includes(e.target)) {
                    ['eventModal', 'viewModal', 'confirmModal', 'todayTasksModal'].forEach(id => document.getElementById(id).style.display = 'none');
                    selectInfo = null;
                    activeEvent = null;
                }
            };
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bottomNav = document.querySelector('.bottom-nav');
            const header = document.querySelector('.header');
            if (bottomNav) {
                fetch('nav_bottom.html')
                    .then(res => res.text())
                    .then(html => {
                        bottomNav.innerHTML = html;
                    });
            } else {
                console.warn('bottom-nav element not found');
            }


            if (header) {
                fetch('header.html')
                    .then(res => res.text())
                    .then(html => {
                        header.innerHTML = html;
                    });
            } else {
                console.warn('header element not found');
            }
        });
    </script>
</body>

</html>